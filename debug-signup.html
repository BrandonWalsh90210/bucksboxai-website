<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Signup - BucksBox.ai</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        .container {
            background: #000;
            padding: 30px;
            border: 1px solid #0f0;
            border-radius: 5px;
        }
        h1 {
            color: #0f0;
            text-align: center;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #0f0;
            background: #001100;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #001100;
            color: #0f0;
            border: 1px solid #0f0;
            font-family: monospace;
        }
        button {
            cursor: pointer;
            background: #003300;
        }
        button:hover {
            background: #005500;
        }
        .log {
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #0f0;
            background: #000;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Supabase Debug Mode</h1>
        
        <div class="status" id="status">
            Initializing...
        </div>
        
        <form id="testForm">
            <input type="email" id="email" placeholder="test@example.com" value="test@example.com">
            <input type="password" id="password" placeholder="TestPass123!" value="TestPass123!">
            <button type="submit">Test Registration</button>
        </form>
        
        <h3>Console Log:</h3>
        <div class="log" id="log"></div>
    </div>

    <script>
        // Enhanced logging
        const logDiv = document.getElementById('log');
        const statusDiv = document.getElementById('status');
        
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<span class="${color}">[${time}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function setStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        // Start logging
        log('=== SUPABASE DEBUG MODE STARTED ===', 'success');
        log('Page URL: ' + window.location.href);
        log('Origin: ' + window.location.origin);
        
        // Supabase configuration
        const SUPABASE_URL = 'https://ypesemlagxsdixjxvrpb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwZXNlbWxhZ3hzZGl4anh2cnBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NzYzODgsImV4cCI6MjA3MjU1MjM4OH0.Q6OnAHRJCpIAdWP3fCgtsaVF_YLM0ov9-p6nhluUPm8';
        
        log('Supabase URL: ' + SUPABASE_URL);
        log('Key prefix: ' + SUPABASE_ANON_KEY.substring(0, 20) + '...');
        
        let supabaseClient = null;
        
        // Load Supabase
        function loadSupabase() {
            log('Loading Supabase library...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/@supabase/supabase-js@2';
            script.onload = () => {
                log('Supabase library loaded', 'success');
                initializeSupabase();
            };
            script.onerror = (e) => {
                log('Failed to load Supabase library: ' + e, 'error');
                setStatus('Library load failed', 'error');
            };
            document.head.appendChild(script);
        }
        
        // Initialize Supabase
        function initializeSupabase() {
            try {
                log('Initializing Supabase client...');
                
                if (typeof supabase === 'undefined') {
                    throw new Error('Supabase object not found');
                }
                
                const { createClient } = supabase;
                supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                log('Supabase client initialized', 'success');
                log('Client object created: ' + (supabaseClient ? 'YES' : 'NO'));
                setStatus('Ready for testing', 'success');
                
                // Test connection
                testConnection();
                
            } catch (error) {
                log('Initialization error: ' + error.message, 'error');
                log('Error stack: ' + error.stack, 'error');
                setStatus('Initialization failed', 'error');
            }
        }
        
        // Test connection
        async function testConnection() {
            log('Testing Supabase connection...');
            try {
                const { data, error } = await supabaseClient.auth.getSession();
                if (error) throw error;
                log('Connection test passed', 'success');
                log('Session data: ' + JSON.stringify(data));
            } catch (error) {
                log('Connection test failed: ' + error.message, 'error');
            }
        }
        
        // Form submission
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!supabaseClient) {
                log('Error: Supabase client not initialized', 'error');
                return;
            }
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log('=== STARTING REGISTRATION TEST ===', 'info');
            log('Email: ' + email);
            log('Password length: ' + password.length);
            
            setStatus('Attempting registration...', 'info');
            
            try {
                log('Calling supabase.auth.signUp()...');
                
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) {
                    log('Registration failed!', 'error');
                    log('Error message: ' + error.message, 'error');
                    log('Error code: ' + (error.code || 'N/A'), 'error');
                    log('Error status: ' + (error.status || 'N/A'), 'error');
                    log('Error details: ' + JSON.stringify(error), 'error');
                    setStatus('Registration failed: ' + error.message, 'error');
                } else {
                    log('Registration successful!', 'success');
                    log('User ID: ' + (data.user ? data.user.id : 'N/A'), 'success');
                    log('Email: ' + (data.user ? data.user.email : 'N/A'), 'success');
                    log('Session: ' + (data.session ? 'Created' : 'Pending email confirmation'), 'success');
                    setStatus('Success! Check email for confirmation', 'success');
                }
                
            } catch (error) {
                log('Unexpected error!', 'error');
                log('Error type: ' + error.constructor.name, 'error');
                log('Error message: ' + error.message, 'error');
                log('Error stack: ' + error.stack, 'error');
                setStatus('Unexpected error: ' + error.message, 'error');
            }
        });
        
        // Start loading
        loadSupabase();
    </script>
</body>
</html>